<% page_title "BEAUTYMEETS > #{@tutorial.try(:title)}" %>
<% page_thumb "#{full_url(@tutorial.thumbnail.image_url)}" if @tutorial.thumbnail.present? %>
<% page_desc "Discovery, Learn, and Be beautiful in BEAUTYMEETS!!" || (@tutorial.title.present? ? "#{@tutorial.title} 영상을 만나보세요." : "") %>

<div class="row" style="">
  <div class="large-12 columns"> 
		<h4 style="letter-spacing:-0.5px;">Beautorials </h4>

		<h5 class="subheader"><small>TUTORIAL > 
		<% @tutorial.categories.each do |category| %>
			<%= category.name %>
		<% end %>
		</small></h5>
  </div>    
</div>
<div class="row">
	<div class="small-12 medium-4 columns">
		<%= image_tag @tutorial.thumbnail.image_url(:medium) if @tutorial.thumbnail.present? %>
	</div>
	<div class="small-12 medium-8 columns">
      <h2 class="subheader"><%= best_in_place @tutorial, :title %></h2>
      <h3><small class="right"><%= render 'bookmarks/star' %></small></h3>
      <h6 class="subheader ">
				<% if @tutorial.categories.present? %>
					<small>Category : </small>
					<% @tutorial.categories.each do |category| %>
						&nbsp;<span class=" secondary tiny label"><%= link_to category.name, category_path(category) %></span>
					<% end %>
				<% end %>
			</h6>
      <div class="text-right"><%= link_to "Edit", edit_tutorial_path if can? :manage, @tutorial %></div>
      <div><%= render partial: 'users/avatar_thumb', locals: { user: @tutorial.author } if @tutorial.author.present? && @tutorial.author.image.present? %>
              &nbsp;<span class="group_name" ><strong><%=  link_to @tutorial.author.try(:name), beautystar_path(@tutorial.author.profile) %></strong>&nbsp;<small><%= " | #{@tutorial.author.profile.try(:job_title)}" %></small></span>
      </div>
      
			<p><%= @tutorial.description %></p>
    	<p>
    		<% @tutorial.tag_list.each do |t| %>
	  	  	<span class="label secondary radius"><%= link_to t, tag_path(t) %></span>
		   	<% end %>
			</p>
  </div>
</div>

<% if @tutorial.vimeo_url.present? %>
<div class="row">
	<div class="small-12 columns">
  	<hr> 
		<div class="flex-video widescreen vimeo">
			<iframe width="420" height="315" src="<%= @tutorial.vimeo_url %>" frameborder="0" allowfullscreen></iframe>
		</div>
		<hr> 
	</div>
</div>
<% end %>

<div class="row" style="">
	<div class="small-12 columns " >
		<h5><small>다른 이미지</small></h5>
		<%= render partial: 'pictures/gallery', locals: {thumb_size: :small} %>
		<%= render 'pictures/form' if (can? :manage, @tutorial)  %>
	</div>
</div>

<% if (!@tutorial.items.nil?)  && (@tutorial.items.count > 0) %>

<div class="row" >
	<div class="small-12 medium-3  columns" style="margin:20px 0 0 0;">		
		<% header_item = @tutorial.items.sample(1).first %>
		<%= image_tag(header_item.thumbnail.image_url(:medium)) if header_item.thumbnail.present? %><br/>
		<span class="subheader" style="font-size:0.75rem; padding-bottom:0; margin-bottom:0"><%= header_item.brand.try(:name) %></span><br/>
		<span  style="font-size:0.8rem; "><strong><%= link_to truncate(header_item.try(:name), 20), item_path(header_item) %></strong></span>
								
	</div>
	<div class="small-12 medium-9  columns" style="margin:20px 0 0 0;">		
		
		<dl class=" accordion" data-accordion >
			<dd >
					<a href="#video-description" >사용된 화장품 보기<%= "(로그인후 확인 가능합니다.)" if !user_signed_in? %><i class="right fa fa-chevron-down"></i></a>
					<div class="content" id="video-description">

						<h4 class="subheader" ><strong><small>사용된 주요 제품</small></strong></h4>
						<% if user_signed_in? %>
							<ul class="inline-list">

							<% @tutorial.items.each do |tutorial_item| %>			
								<li style="margin-bottom:15px;" >
									<span style="height:1px;"></span>
									<%= link_to image_tag(tutorial_item.thumbnail.image_url(:medium), :style => "width:100px; height:100px;"), item_path(tutorial_item), :class => "th" if tutorial_item.thumbnail.present? %>
									<span class="subheader" style="font-size:0.75rem; padding-bottom:0; margin-bottom:0"><%= tutorial_item.brand.try(:name) %></span>
									<span  style="font-size:0.8rem; "><strong><%= link_to truncate(tutorial_item.try(:name), 10), item_path(tutorial_item) %></strong></span>
									<%= link_to "&nbsp;X".html_safe, tutorial_item_unitemize_path(@tutorial, tutorial_item), :id => tutorial_item.id  , :data => { :confirm => 'Are you sure?' }, method: :delete  if can? :manage, @tutorial %>
									
								</li>
							<% end %>			

							</ul>
						<% else %>
							<h6 class="subheader">로그인 이후 확인 가능합니다. </h6>
							<a href="#" data-reveal-id="signup-modal" class="button tiny" >회원가입</a>
              <a href="#" data-reveal-id="signin-modal" class="button tiny secondary">로그인</a>
            <% end %>
					</div>
			</dd>
		</dl>
	</div>
</div>
<% end %>
			<% if can? :manager, @tutorial %>
			<div>
			<p><h4>Add Product</h4></p>
			<%= #render 'items/small_form' 
			%>
			<%= simple_form_for [@itemizable] do |f| %>
			  <%= f.error_notification %>

			    <%= f.input :item_name, :url => autocomplete_item_name_tutorials_path, :as => :autocomplete %>
			    <%= f.button :submit, 'Add It' %>

			<% end %>
			<% end %>
		</div>

    <div class="fb-like" data-href="<%= tutorial_url(@tutorial) %>" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div>

<div class="row" style="margin:2.5rem 0 0 0;">
	<div class="small-12 medium-8 columns">		
		<h3 class="subheader"><%= render partial: 'users/avatar_thumb', locals: { user: @tutorial.author } if @tutorial.author.present? && @tutorial.author.image.present? %>&nbsp;Q&A&nbsp;<small><%= @tutorial.author.name %>님에게 궁금한 질문을 남겨주세요.</small>
		</h3>
		Comments(<%= @tutorial.comments.count %>)
		<%= render partial: "comments/form", locals: { form_message: "#{@tutorial.title}에 대한 질문들을 남겨주세요." }    %>    
		<%= render "comments/comments" || "댓글이 없습니다." %>
	</div>
</div>
<div class="row" style="margin-bottom:5rem;">
	<div class="small-12 medium-12 columns">		
		<h3>추천 영상 보기&nbsp;<small><%= @tutorial.title %>과 함께 보면 좋은 영상들</small></h3>
		<hr>
		<h4>튜토리얼&nbsp;<small>뷰티밋츠가 직접 제작한 리얼 뷰티 튜토리얼입니다.</small></h4>
			<div class="row" style="">
				<%= render @tutorials %>
			</div>
		<h4>비디오&nbsp;<small>뷰티밋츠가 엄선한 뷰티 비디오입니다.</small></h4>
			<div class="row" style="">
				<%= render @videos %>
			</div>
	</div>
</div>


	<div class="row">
		<div class="small-12 medium-4 small-centered medium-centered columns">
		<a href="#" id="to_top" style="margin:30px auto 10px auto; padding:10px 20px;" class="button expand">Top<i class="right fa fa-chevron-up"></i></a>
	</div>
	</div>

<script type="text/javascript">
    $(document).ready(function(){ 

		// Hide scroll top button
		var top = $('#to_top');
		top.hide();
 
        $(window).scroll(function(){

            if ($(this).scrollTop() > 100) {
                top.fadeIn();
            } else {
                top.fadeOut();
            }
        }); 
 
        top.click(function(){
            $("html, body").animate({ scrollTop: 0 }, 1000);
            return false;
        });
 
    });
</script>